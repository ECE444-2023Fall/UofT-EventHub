{% extends "bootstrap/base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

<!-- This is the general template for showcasing events -->

{% block title %}Event's Page{% endblock %}
{% block navbar %}
<div class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Event Planner</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="/">Home</a></li>
            </ul>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="/logout">Log out</a></li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<div class="container">
    {% for message in get_flashed_messages() %}
    <div class="alert alert-warning">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        {{ message }}
    </div>
    {% endfor %}

    {% block page_content %}
        <div class="page-header">
            <h1>{{event.name}}</h1>
            <p>{{event.description}}</p>
            <p>Venue: {{event.venue}}</p>
            <button type="button" id="register_btn" class="btn btn-primary">Register</button>
        </div>
        <div>
          <img src="send_file/event_banner_{{event.id}}.png" class="img-rounded" alt="Event Banner">
        </div>
        <script type=text/javascript>
            $(function() {
              $('button#register_btn').on('click', function(e) {
                e.preventDefault()
                $.getJSON("/event_register/{{event.id}}",
                    function(data) {                  
                        // If successfully registered change the button color and text
                        if (data == "0") {
                            // Change button text and color
                            $("button#register_btn").text("Registered");
                            $("button#register_btn").css("background-color", "#808080");
                            console.log("User is registered")

                            // TODO: Pop up to say you are now registered
                        }

                        // If the user is already registered
                        if (data == "4") {
                            // Change button text and color
                            $("button#register_btn").text("Registered");
                            $("button#register_btn").css("background-color", "#808080");

                            // TODO: Pop up to say you are already registered
                            console.log("User is already registered")
                        }
                });
                return false;
              });
            });
    </script>
    {% endblock %}
</div>
{% endblock %}
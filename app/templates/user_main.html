{% extends "base.html" %}
{%block title %}User's Page{% endblock %} 

{% block navbar %}
 <!-- this overrides the definition of the navbar in base.html-->
<nav class="navbar navbar-expand-lg navbar-light bg-light custom-navbar">
<a class="navbar-brand" href="/"> <img src="{{ url_for ('static', filename='images/final_logo.png')}}" alt="logo" width="175.6" height="46"></a>
<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarNavDropdown">
    <ul class="navbar-nav">
    <li class="nav-item active">
        <a class="nav-link" href="/">Home <span class="sr-only"></span></a>
    </li>
    <!--<li class="nav-item">
        <a class="nav-link" href="/">Engineering</a>
    </li>-->
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="/" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Profile
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
        <a class="dropdown-item" href="/myevents">My Events</a>
        <a class="dropdown-item" href="/">Settings</a>
        <a class="dropdown-item" href="/logout">Logout</a>
        </div>
    </li>
    </ul>
</div>
</nav>
{% endblock %} 

{% block content %}
<!-- For JS support -->
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
  integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
></script>

<!-- Container for search and sorting functionality -->
<div class="container">
  {% for message in get_flashed_messages() %}
  <div class="alert alert-warning">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    {{ message }}
  </div>
  {% endfor %}
  {% block page_content %}
    <script>
            $(document).ready(function() {
                console.log("Hello")
                let debounce;
                $('.search-box').on('keydown', function (e) {
                  clearTimeout(debounce)
                  debounce = setTimeout(() => {
                          getAutoComplete();  
                  }, 300);
                })
            })

            function getAutoComplete() {
              const query = $('.search-box').val();
              console.log(query)
              fetch(`http://localhost:5000/search?search=${encodeURIComponent(query.trim())}`)
                .then((resp) => resp.json())
                .then((data) => {
                        $('.results').empty();
                        for (let i = 0; i < data.length; i++) {
                                $('.results').append(`<li>${data[i]}</li>`)
                        }
                      })
            }
        </script>
        <div class="page-header">
          <h1 style="color: #050151; font-family: Georgia, serif;">University of Toronto Events</h1>
        </div>
        <div class="container search-sort-container">
          <div class="row" style="text-align: center;">
            <div class="col-xs-12 col-sm-12" style="text-align: center;">
              <form action="{{ url_for('search.search_events', filter=filter) }}" method="post">
                  <input class="search-box" name="query" id="search-text" autocomplete="off" placeholder="Search all events...">
                  <button id="search-btn" class="btn btn-light my-2 my-sm-0" type="submit"><i class="fa-solid fa-magnifying-glass" style="color: #ea453f;"></i></button>
                  <!-- <button class="btn btn-light my-2 my-sm-0" type="submit" name="clear-search-button" value="clear">Clear Search</button> -->
              </form>
            </div>
            <div class="col-xs-12 col-sm-12" style="text-align: center;">
              <form action="{{ url_for('filter.filter_events', search=search) }}" method="post">
                  {% for filter_tag in filter_tags %}
                  <button id="sort-key-btn" class="btn btn-light my-2 my-sm-0" type="submit" name="filter-tag" value="{{filter_tag | lower}}">{{filter_tag}}</button>
                  {% endfor %}
                  <button id="sort-clear-btn" class="btn btn-light my-2 my-sm-0" type="submit" name="filter-tag" value="clear">Clear Filters</button>
              </form>
            </div>
          </div>
        </div>
    {% endblock %}
    
    <div class="content">
      <div class="container event-list-container">
          <div class="row">
            {% for key, value in event_data.items() %}
              <div class="col-xs-12 col-sm-4">
                <div class="card">
                    <a class="img-card" href="/events/{{ key }}">
                    <img src="{{ url_for ('static', filename='event-assets/event_banner_' + value.id + '.png')}}" />
                  </a>
                    <div class="card-content">
                        <h4 class="card-title">
                            <a href="/events/{{ key }}"> {{value.name}}
                          </a>
                        </h4>
                        <p class="">
                            {{value.description}}
                        </p>
                    </div>
                    <div class="card-read-more">
                        <a href="/events/{{ key }}" class="btn btn-link btn-block">
                            Read More
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
          </div>
      </div>
  </div>
</div>
{% endblock %}